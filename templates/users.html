<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Th√¥ng tin ng∆∞·ªùi d√πng</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/users.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/styles_quanli_dethi.css') }}">
</head>
<body>
        <!-- menu -->
         <div class="navbar">
    <div class="menu-left">
            {% if username_ss == "admin" %}
                <a href="{{ url_for('ad_login.login') }}">Trang Ch·ªß</a>
            {% else %}
                <a href="{{ url_for('upload.danh_sach_de_thi') }}">Trang Ch·ªß</a>
            {% endif %}
            <div class="subnav">
                <button class="subnavbtn">Qu·∫£n l√≠ ƒë·ªÅ thi <i class="fa fa-caret-down"></i></button>
                <div class="subnav-content">
                <a href="../upload">T·∫°o ƒë·ªÅ thi</a>
                <!-- <a href="#team">Team</a>
                <a href="#careers">Careers</a> -->
                </div>
            </div>
            <div class="subnav">
                <button class="subnavbtn">Ng∆∞·ªùi d√πng <i class="fa fa-caret-down"></i></button>
                <div class="subnav-content">
                <a href="{{ url_for('users.users') }}">Danh s√°ch ng∆∞·ªùi d√πng</a> 
                <a href="{{ url_for('re_teachers.register_teacher') }}">Th√™m m·ªõi</a>
                <!-- <a href="#package">Package</a>
                <a href="#express">Express</a> -->
                </div>
            </div>
            <!-- <div class="subnav">
                <button class="subnavbtn">Partners <i class="fa fa-caret-down"></i></button>
                <div class="subnav-content">
                <a href="#link1">Link 1</a>
                <a href="#link2">Link 2</a>
                <a href="#link3">Link 3</a>
                <a href="#link4">Link 4</a>
                </div>
            </div> -->
            <a href="{{ url_for('xuli_dethi.lam_bai') }}">V√†o Thi</a>
            <a href="#contact">Li√™n h·ªá</a>
        </div> 
           <div class="menu-right">
                <span>üë§ Xin ch√†o, 
                    <div id="usernameClick" style="display: inline;"><strong style="cursor:pointer; text-decoration: underline;">{{ username_ss }}</strong></div>
                </span> <span><a href="{{ url_for('login.logout') }}">ƒêƒÉng xu·∫•t</a></span>
            </div>
    </div>

    <!-- flash -->
         {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div id="flash-message-wrapper">
                {% for category, message in messages %}
                    <div class="flash-message {{ category }}">
                    {{ message }}
                    </div>
                {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
    <!--  -->

    <!-- form -->
    <div id="form-reg">
        <form method="post" action="/add-teacher">
            <label for="name">T√™n gi√°o vi√™n:</label>
            <input type="text" id="name" name="name" required>
            <div>
            <label for="username">Username:<br> <span style="color: red; font-size: 10px;">D√πng ƒëƒÉng nh·∫≠p</span></label></div>
            <input type="text" id="username" name="username" required>

            <label for="school">Tr∆∞·ªùng:</label>
            <input type="text" id="school" name="school" required>

            <label for="sdt">S·ªë ƒëi·ªán tho·∫°i:</label>
            <input type="text" id="sdt" name="sdt" required>

            <input type="submit" value="ƒêƒÉng k√Ω" style="text-align: center;">
        </form>
    </div>
    <!--  -->

    <h1>Danh s√°ch t√†i kho·∫£n gi√°o vi√™n</h1>
    <table border="1">
        <tr>
            <th>STT</th>
            <th>ID</th>
            <th>Username</th>
            <th>Password</th>
            <th>H·ªç v√† t√™n</th>
            <th>Tr∆∞·ªùng</th>
            <th>SƒêT</th>
            <th>Ph√¢n quy·ªÅn</th>
        </tr>
        {% if users %}
            {% for user in users %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ user.id }}</td>
                <td>{{ user.username }}</td>
                <td>{{ user.password }}</td>
                <td>{{ user.name }}</td>
                <td>{{ user.school }}</td>
                <td>{{ user.sdt }}</td>
                <td style="width: 24%;">
                    
                    {% if user.status == 1 %}
                        üë®‚Äçüè´ Gi√°o vi√™n
                    {% elif user.status == 2 %}
                        üêØ Qu·∫£n tr·ªã vi√™n
                    {% elif user.status == 0 %}
                        ‚ùå ƒê√£ kh√≥a
                    {% else %}
                        ‚ö†Ô∏è Kh√¥ng x√°c ƒë·ªãnh
                    {% endif %}
                    {% if user.status in [0, 1] %}
                        <form action="{{ url_for('users.unlock_user' if user.status == 0 else 'users.lock_user', user_id=user.id) }}" method="POST" style="display: inline;">
                            <button class="quay-ve-btn" type="submit" style="display: inline;" title="{% if user.status == 0 %}ƒê√£ kh√≥a ho·∫∑c ch∆∞a ƒë∆∞·ª£c k√≠ch ho·∫°t t√†i kho·∫£n{% endif %}">
                                {{ "üîì M·ªü kh√≥a" if user.status == 0 else "üîí Kh√≥a" }}
                            </button>
                        </form>
                    {% endif %}
                    {% if user.status in [0, 1] %}
                    <form action="{{ url_for('users.repass', user_id=user.id) }}" method="post" style="display: inline;">
                        <button class="quay-ve-btn" style="display:inline;" type="submit" onclick="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u v·ªÅ 123456?')" title="ƒê·∫∑t l·∫°i m·∫≠t kh·∫©u l√†: 123456">
                            ƒê·∫∑t l·∫°i m·∫≠t kh·∫©u
                        </button>
                    </form>
                    {% endif %}
                    {% if user.status in [0, 1] %}
                    <form action="{{ url_for('users.delete_user', user_id=user.id) }}" method="POST" style="display: inline;">
                            <button class="quay-ve-btn" type="submit" style="display: inline;" title="X√≥a t√†i kho·∫£n {{ user.username }}">
                                {{ "X√≥a t√†i kho·∫£n" }}
                            </button>
                    </form>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
            {% else %}
                <tr>
                    <td colspan="9" style="text-align: center; font-style: italic; color: #666;">
                        Kh√¥ng c√≥ ng∆∞·ªùi d√πng n√†o!</td>
                </tr>
        {% endif %}
    </table>
    <div>
        {% if page > 1 %}
            <a href="{{ url_for('users.users', page=page-1) }}">{{page-1}}</a>
        {% endif %}
        <span>Trang {{ page }}</span>
        <a href="{{ url_for('users.users', page=page+1) }}">{{page+1}}</a>
    </div>
    <a href="/">Quay l·∫°i trang ch·ªß</a>


<!-- form change-password -->
 <div id="changePasswordModal" style="display:none; position: fixed; top:0; left:0; 
    width:100%; height:100%; background: rgba(0,0,0,0.5); z-index:99999; justify-content:center; align-items:center;">
    <div style="background:white; padding:20px; border-radius:10px; width:320px; position:relative;">
        <h3>ƒê·ªïi m·∫≠t kh·∫©u</h3>
        <form method="POST" action="{{ url_for('users.change_password') }}">
            <label>M·∫≠t kh·∫©u hi·ªán t·∫°i:</label>
            <input type="password" name="old_password" required style="width:100%; padding:5px;"><br>
            
            <label>M·∫≠t kh·∫©u m·ªõi:</label>
            <input type="password" name="new_password" required style="width:100%; padding:5px;"><br>
            
            <label>Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi:</label>
            <input type="password" name="confirm_password" required style="width:100%; padding:5px;"><br>
            
            <button type="submit" style="padding:8px 15px;">L∆∞u thay ƒë·ªïi</button>
            <button type="button" onclick="closeChangePasswordModal()" style="padding:8px 15px; background:#ccc;">H·ªßy</button>
        </form>
    </div>
</div>
<!--  -->

<script>
    setTimeout(function() {
        var flash = document.getElementById('flash-message');
        if (flash) {
        flash.style.display = 'none';
        }
    }, 3000); // 5000 milliseconds = 5 gi√¢y

    function copyToClipboard(text) {
        if (!navigator.clipboard) {
            // Fallback n·∫øu tr√¨nh duy·ªát c≈©
            const textarea = document.createElement("textarea");
            textarea.value = text;
            textarea.style.position = "fixed";
            textarea.style.opacity = 0;
            document.body.appendChild(textarea);
            textarea.focus();
            textarea.select();
            try {
                document.execCommand("copy");
                showCopiedMessage(text);
            } catch (err) {
                console.error("Fallback copy failed", err);
            }
            document.body.removeChild(textarea);
            return;
        }

        navigator.clipboard.writeText(text).then(function() {
            showCopiedMessage(text);
        }, function(err) {
            console.error("Copy failed", err);
        });
    }

    function showCopiedMessage(text) {
        const msg = document.createElement("div");
        msg.textContent = "‚úÖ ƒê√£ copy m√£ ƒë·ªÅ: " + text;
        msg.style.position = "fixed";
        msg.style.top = "20px";
        msg.style.right = "20px";
        msg.style.background = "#4CAF50";
        msg.style.color = "white";
        msg.style.padding = "10px 15px";
        msg.style.borderRadius = "8px";
        msg.style.boxShadow = "0 2px 5px rgba(0,0,0,0.2)";
        msg.style.zIndex = 9999;
        msg.style.opacity = 0;
        msg.style.transition = "opacity 0.3s";

        document.body.appendChild(msg);

        // L√†m m·ªù v√† ·∫©n sau 2.5s
        setTimeout(() => msg.style.opacity = 1, 10);
        setTimeout(() => {
            msg.style.opacity = 0;
            setTimeout(() => msg.remove(), 300);
        }, 2500);
    }

    window.addEventListener('DOMContentLoaded', () => {
        const flash = document.getElementById('flash-message');
        if (flash) {
            flash.style.opacity = 1;
            setTimeout(() => {
                flash.style.opacity = 0;
                setTimeout(() => {
                    flash.remove();
                }, 500);
            }, 3000); // hi·ªán 3s r·ªìi m·ªù d·∫ßn
        }
    });

document.addEventListener('DOMContentLoaded', function(){
    document.getElementById('usernameClick').addEventListener('click', function(){
        document.getElementById('changePasswordModal').style.display = 'flex';
    });
});

function closeChangePasswordModal(){
    document.getElementById('changePasswordModal').style.display = 'none';
}

</script>

</body>
</html>
